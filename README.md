# CalcOPP
A Program for the Calculation of Effective One-Particle Potentials (OPPs)

![GitHub Release](https://img.shields.io/github/release/dewiedem/calcopp.svg)
![GitHub Release Date](https://img.shields.io/github/release-date/dewiedem/calcopp.svg)
![GitHub License](https://img.shields.io/github/license/dewiedem/calcopp.svg)

## Author and Maintainer
Dr. Dennis Wiedemann\
Technische Universität Berlin\
Institut für Chemie, Sekr. C 2\
Straße des 17. Juni 135\
10623 Berlin, Germany

Phone:	+49 30 314-26178\
Fax:	+49 30 314-79656\
E-mail:	[dennis.wiedemann@chem.tu-berlin.de](mailto:dennis.wiedemann@chem.tu-berlin.de)\
Web:	http://dennis.wiedemann.name

## Description and Rationale
In the OPP approach, every atom is treated as an individual Einstein oscillator subject to Boltzmann statistics in the classical limit. The effective OPP itself represents the potential as experienced by an atom at a certain position and allows, *e.g.*, to assess the viability and activation barriers of migration pathways (see [K. N. Trueblood *et al.*, *Acta Crystallogr., Sect. A: Found. Crystallogr.* **1996**, *52*, 770–781](https://doi.org/10.1107/S0108767396005697) and [H. Boysen, *Z. Kristallogr.* **2003**, *218*, 123–131](https://doi.org/10.1524/zkri.218.2.123.20668)).

The OPP *V*(***u***) experienced by an atom displaced from its reference position by a vector ***u*** can be calculated from any probability-density function (PDF) *p*(***u***) adequately describing it: *V*(***u***) = –ln[*p*(***u***)/*p*(**0**)] (*cf.* [H. Boysen, *Z. Kristallogr.* **2003**, *218*, 123–131](https://doi.org/10.1524/zkri.218.2.123.20668)). A PDF has to be non-negative, Lebesgue-integrable, and normalized to an integral of unity over the whole space.

Although it is far from mathematically rigorous, the following rationale suggests that a ratio of scattering-length or electron densities within carefully chosen limits has the properties of a probability-density ratio:

- *Adequacy:* If the negative/positive scattering-length density is solely generated by the unique atom under scrutiny, the former is an adequate measure for the distribution of the latter. In all other cases (another static negative/positive scatterer, investigation of electron density, *etc.*), it is adequate if the scope is limited to areas accessible for the atom (*i.e.*, the environment of the migration pathways).
- *Non-Negativity:* Only non-negative ratios, in which both probability density values are either negative or positive, are taken into account.
- *Integrability:* Scattering-length and electron densities are Lebesgue-integrable.
- *Normalization:* For ratios of probability density values, normalization is unnecessary (the normalizing constant cancels).

Depending on the problem, CalcOPP allows to calculate the effective OPP from a PDF sampled in 2D or 3D by [JANA2006](http://jana.fzu.cz/) or from the MEM-reconstructed scatterer density sampled using [Dysnomia](https://jp-minerals.org/dysnomia/en/)—under certain additional conditions. It can also reformat 2D PDF input and handle the associated error maps.

## Compiling
### Modules *calcopp-gui* and *sd2opp*
The source code adheres to the specifications of Python 3.7 and heeds [*PEP 8 – Style Guide for Python Code*](https://www.python.org/dev/peps/pep-0008/). It has been compiled using Python X.X.X/X.X.X (Windows/Linux) and [PyInstaller](https://www.pyinstaller.org/) X.X.X with assert statements, any code conditional on the value of `__debug__`, and docstrings removed.

```
python -OO -m PyInstaller --onefile --name="CalcOPP[.exe]" calcopp-gui.py
python -OO -m PyInstaller --onefile --name="sd2opp[.exe]" sd2opp.py
```

The module *calcopp-gui* relies on [PySimpleGUI](https://pypi.org/project/PySimpleGUI/), used in version X.X.X for compiling. The module *sd2opp* relies on [NumPy](https://www.numpy.org/), used in version X.X.X for compiling.

### Modules *pdf2opp_2d* and *pdf2opp_3d*
The source code adheres the specifications of Fortran 2008 with GNU-specific extensions. It has been compiled using GFortran from GCC X.X.X/X.X.X (Windows/Linux) with static linking, all symbol table and relocation information removed, and optimization level set to “O3”:

```
gfortran -std=f2008 -fall-instrinsics -pedantic -Wall -Wextra -O3 -static -s [-m64] pdf2opp_2d.f08 -o pdf2opp_2d[.exe]
gfortran -std=f2008 -fall-instrinsics -pedantic -Wall -Wextra -O3 -static -s [-m64] pdf2opp_3d.f08 -o pdf2opp_3d[.exe]
```

## Installation
Unpack one of the archives (64-/32-bit version for Windows/Linux) into any user-writable directory. For the graphical user interface (GUI) to work correctly, the executables must be in a common directory. You can also use the executables `pdf2opp_2d[.exe]`, `pdf2opp_3d[.exe]`, and `sd2opp[.exe]` in a stand-alone (scriptable) fashion. It may be necessary to set the execute permission on Unix-like systems.

## Usage
### GUI
Start the application `CalcOPP[.exe]` *via* desktop environment or shell. Further instructions are displayed in the box on the left. 

### Drag and Drop
For `pdf2opp_2d[.exe]`, you can drag and drop the icon of an appropriate `*.stf` file on the icon of the executable. The latter will then try to read the measurement temperature from a JANA2006 `*.m90` file in the working directory and, if the file is found, automatically write the output to `*_opp.asc`. If an error map with the name `*_err.stf` is also present, it will be processed, too.

For `pdf2opp_3d[.exe]`, you can drag and drop the icon of an appropriate `*_tmp.xsf` file on the icon of the executable. The latter will then try to read the measurement temperature from a JANA2006 `*.m90` file in the working directory and, if the file is found, automatically write the output to `*_opp.xsf` and `*_opp.vesta`.

### Command Line
If you want to use the executables `pdf2opp_2d[.exe]`, `pdf2opp_3d[.exe]`, or `sd2opp[.exe]` from the command line, please invoke them with the parameter `-h` (for help) to display their usage.

## Acknowledgement
CalcOPP has been inspired by work from Dr. Hans Boysen (Ludwig-Maximilians-Universität München) and Dr. Anatoliy Senyshyn (Technische Universität München).

## Citation
If you prepare data for publication with CalcOPP, please use the following citation:

D. Wiedemann, CalcOPP, Calculation of Effective One-Particle Potentials, Technische Universität Berlin, Berlin (Germany), **2019**, [doi:XXX](https://doi.org/XXX).

## Contributing
It is much appreciated if you report any bugs or typos to the above e-mail address.
