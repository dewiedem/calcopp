# CalcOPP
A Suite for the Calculation of One-Particle Potentials (OPPs)

![GitHub Release](https://img.shields.io/github/release/dewiedem/calcopp.svg)
![GitHub Release Date](https://img.shields.io/github/release-date/dewiedem/calcopp.svg)
![GitHub License](https://img.shields.io/github/license/dewiedem/calcopp.svg)

## Author and Maintainer
Dr. Dennis Wiedemann\
Technische Universität Berlin\
Institut für Chemie, Sekr. C 2\
Straße des 17. Juni 135\
10623 Berlin, Germany

Phone:	+49 30 314-26178\
Fax:	+49 30 314-79656\
E-mail:	[dennis.wiedemann@chem.tu-berlin.de](mailto:dennis.wiedemann@chem.tu-berlin.de)\
Web:	http://dennis.wiedemann.name

## Description
In the OPP approach, every atom is treated as an individual Einstein oscillator subject to Boltzmann statistics in the classical limit. The OPP itself represents the potential as experienced by an atom at a certain position and allows, *e.g.*, to assess the viability and activation barriers of migration pathways (see [K. N. Trueblood *et al.*, *Acta Crystallogr., Sect. A: Found. Crystallogr.* **1996**, *52*, 770–781](https://doi.org/10.1107/S0108767396005697) and [H. Boysen, *Z. Kristallogr.* **2003**, *218*, 123–131](https://doi.org/10.1524/zkri.218.2.123.20668)).

Depending on the problem, CalcOPP allows to calculate the OPP from a probability-density function (PDF) sampled in 2D or 3D by [JANA2006](http://jana.fzu.cz/) or from the MEM-reconstructed scatterer density sampled using [Dysnomia](https://jp-minerals.org/dysnomia/en/)—under certain additional conditions. It can also reformat 2D PDF input and handle the associated error maps.

## Compiling
### Modules *calcopp-gui* and *sd2opp*
The source code adheres to the specifications of Python 3.7 and heeds [*PEP 8 – Style Guide for Python Code*](https://www.python.org/dev/peps/pep-0008/). It has been compiled using Python X.X.X/X.X.X (Windows/Linux) and [PyInstaller](https://www.pyinstaller.org/) X.X.X with assert statements, any code conditional on the value of `__debug__`, and docstrings removed.

`python -OO -m PyInstaller --name="CalcOPP[.exe]" calcopp-gui.py`
`python -OO -m PyInstaller --name="sd2opp[.exe]" sd2opp.py`

The module *calcopp-gui* further relies on [PySimpleGUI](https://pypi.org/project/PySimpleGUI/), used in version X.X.X for compiling.

### Modules *pdf2opp_2d* and *pdf2opp_3d*
The source code adheres strictly to the specifications of Fortran2003. It has been compiled using GFortran from GCC X.X.X/X.X.X (Windows/Linux) with static linking, all symbol table and relocation information removed, and optimization level set to “O3”:

`gfortran -std=f2003 -pedantic -Wall -Wextra -O3 -static -s [-m64] pdf2opp_2d.f03 -o pdf2opp_2d[.exe]`
`gfortran -std=f2003 -pedantic -Wall -Wextra -O3 -static -s [-m64] pdf2opp_3d.f03 -o pdf2opp_3d[.exe]`

## Installation
Unpack one of the archives (64-/32-bit version for Windows/Linux) into any user-writable directory. For the graphical user interface (GUI) to work correctly, the executables must be in a common directory. You can also use the executables `pdf2opp_2d[.exe]`, `pdf2opp_3d[.exe]`, and `sd2opp[.exe]` in a stand-alone (scriptable) fashion. It may be necessary to set the execute permission on Unix-like systems.

## Usage
### GUI
Start the application `CalcOPP[.exe]` *via* desktop environment or shell. Further instructions are displayed in the box on the left. 

### Drag and Drop
For `pdf2opp_2d[.exe]`, you can drag and drop the icon of an appropriate `*.stf` file on the icon of the executable. The latter will then try to read the measurement temperature from a JANA2006 `*.m90` file in the working directory and, if the file is found, automatically write the output to `*_opp.asc`. If an error map with the name `*_err.stf` is also present, it will be processed, too.

For `pdf2opp_3d[.exe]`, you can drag and drop the icon of an appropriate `*_tmp.xsf` file on the icon of the executable. The latter will then try to read the measurement temperature from a JANA2006 `*.m90` file in the working directory and, if the file is found, automatically write the output to `*_opp.xsf` and `*_opp.vesta`.

### Command Line
If you want to use the executables `pdf2opp_2d[.exe]`, `pdf2opp_3d[.exe]`, or `sd2opp[.exe]` from the command line, please invoke them with the parameter `-h` (for help) to display their usage.

### Input and Output
CalcOPP accepts well-formed STF files as generated by JANA2000 or JANA2006. The input file has to contain probability-density function (PDF) data sampled on a uniform grid. CalcOPP can only use 2D data from a single section. The output is a generic ASCII file of space-separated values giving x, y, PDF, and OPP value (both with errors, if a map has supplied) for every grid point. It is fit for plotting with most modern applications (*e.g.*, QtiPlot or Origin).

CalcOPP-3D accepts well-formed temporary XSF files as generated by JANA2006 (`*_tmp.xsf`). The input file has to contain PDF data sampled on a uniform grid. Only the first 3D data grid stored in the file is taken into account. The output is a file of the same type (`*_opp.xsf`). All lines before and after the first 3D data grid are copied into it verbatim. In addition, a file is provided to be directly opened in VESTA (`*_opp.vesta`).

For visualization in VESTA, the displaying of sections should be switched off, as the high OPP in most of the unit cell would probably obscure any area of interest. The isovalue (given in electronvolt) must then be chosen reasonably.

### Caveats
Any file with the same name as the standard or chosen output file will be **overwritten without asking**! Be sure to save any intermediate result that you are going to need.

In *pdf2opp_2d*, for grid points with a non-positive PDF, arbitrarily huge OPPs and OPP errors of 10<sup>9</sup> meV are set instead of the mathematically rigorous +∞. Nevertheless, this physically means a potential barrier of insurmountable height.

In *pdf2opp_3d*, for grid points with a non-positive PDF, the highest finite OPP in the data (derived from the lowest positive PDF) is set to make the fringes of visualized isosurfaces less spiky after treatment with VESTA’s interpolation algorithm. When further processing the data or extracting values directly, however, you must be aware that, **at these points, the potential barrier is insurmountably (infinitely) high**.

## Acknowledgement
CalcOPP has been inspired by work from Dr. Hans Boysen (Ludwig-Maximilians-Universität München) and Dr. Anatoliy Senyshyn (Technische Universität München).

## Citation
If you prepare data for publication with CalcOPP, please use the following citation:

D. Wiedemann, CalcOPP, Calculation of One-Particle Potentials, Technische Universität Berlin, Berlin (Germany), **2019**, [doi:XXX](https://doi.org/XXX).

## Contributing
I am not looking for contributors at the moment, but feel free to contact me for bug reports and discussion.
